<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Metrophobic&family=Outfit:wght@100..900&display=swap"
        rel="stylesheet">
    <title>Dashboard</title>
    <link rel="stylesheet" href="../../css/dashboard.css">
</head>

<body>
    <div class="wrapper">
        <header>
            <div class="left">
                <a href="/"><img width="80px" src="/images/logo.png" alt="logo"></a>
                <div class="lefttext">
                    <div class="up">
                        <h1>Physi</h1>
                        <h1>CURE</h1>
                    </div>
                    <div class="down">
                        <h2 style="font-size: 15px;">Physical Therapy</h2>
                    </div>
                </div>
            </div>
            <nav class="right">
                <p><a href="/">Home</a></p>
                <p><a href="/login">L·ªãch h·∫πn</a></p>
                <p><a href="/html/location.html">C∆° s·ªü</a></p>
                <p><a href="/html/services.html">D·ªãch v·ª•</a></p>
                <p><a href="/html/blog.html">Blog</a></p>
                <p style="width: 85px;"><a href="/html/career.html">Tuy·ªÉn d·ª•ng</a></p>
                <p><a href="/" class="header-logout">ƒêƒÉng xu·∫•t</a></p>
            </nav>
        </header>
        <div style="color: white; width: 100%; height: 80px;"></div>
        <!-- <div>
            <%= JSON.stringify(schedule_data)%>
        </div> -->
        <div class="modal-container">
            <section class="modal hidden">
                <div class="flex">
                    <div>
                        <h2>ƒê·∫∑t l·ªãch kh√°m ü©∫</h2>
                    </div>
                    <button type="button" class="btn-close">‚úñ</button>
                </div>
                <form id="form" action="/api/user-create-new-schedule" method="post">
                    <div class="form-group">
                        <section>
                            <label for="appointmentTime">Ca kh√°m</label>
                            <select id="appointmentTime" name="appointmentTime" required>
                                <option value="07:00">7:00 AM</option>
                                <option value="09:00">9:00 AM</option>
                                <option value="14:00">14:00 PM</option>
                                <option value="16:00">16:00 PM</option>
                            </select>
                        </section>
                        <section>
                            <label for="appointmentDate">Ng√†y</label>
                            <input type="date" id="appointmentDate" name="appointmentDate" required />
                        </section>

                    </div>
                    <section>
                        <label for="facilityId">Chi nh√°nh</label>
                        <select id="facilityId" name="facilityId" required>
                            <option value="1">H√† N·ªôi</option>
                            <option value="2">ƒê√† N·∫µng</option>
                            <option value="3">H·ªì Ch√≠ Minh</option>
                            <option value="4">B√¨nh D∆∞∆°ng</option>
                        </select>
                    </section>
                    <section>
                        <label for="symptom">Tri·ªáu ch·ª©ng</label>
                        <textarea id="symptom" placeholder="tri·ªáu ch·ª©ng c·ªßa b·ªánh, ch·∫•n th∆∞∆°ng" name="symptom"
                            required></textarea>
                    </section>
                    <div class="btn-container">
                        <button class="btn submit-form" type="submit">Submit</button>
                    </div>
                </form>
            </section>
            <div class="overlay hidden"></div>
            <button class="btn btn-open-modal">ƒê·∫∑t l·ªãch kh√°m ngay ü©∫</button>
        </div>

        <div class="schedule-list-wraper">
            <div class="schedule-title">
                <h2>L·ªãch h·∫πn ƒë√£ ƒë·∫∑t</h2>
            </div>
            <div class="schedule-list">
                <% schedule_data.forEach(function(schedule) {%>
                    <div class="card">
                        <div class="flex group">
                            <div class="label">
                                <h3>C∆° s·ªü</h3>
                            </div>
                            <div class="user-data">
                                <%= schedule.facilityName %>
                            </div>
                        </div>
                        <div class="flex group">
                            <div class="label">
                                <h3>Ng√†y</h3>
                            </div>
                            <div class="user-data">
                                <%= schedule.appointmentDate %>
                            </div>
                        </div>
                        <div class="flex group">
                            <div class="label">
                                <h3>Th·ªùi gian</h3>
                            </div>
                            <div class="user-data">
                                <%= schedule.appointmentTime %>
                            </div>
                        </div>


                        <div class="flex group">
                            <div class="label">
                                <h3>X√°c nh·∫≠n</h3>
                            </div>
                            <div class="user-data">
                                <h4 class="<%= schedule.isConfirmed ? 'confirmed' : 'not-confirmed' %>">
                                    <%= schedule.isConfirmed ? "ƒê√£ x√°c nh·∫≠n" : "Ch∆∞a x√°c nh·∫≠n" %>
                                </h4>
                            </div>
                        </div>

                        <div class="flex group">
                            <div class="label">
                                <h3>Tri·ªáu ch·ª©ng</h3>
                            </div>
                            <div class="user-data">
                                <%= schedule.symptom %>
                            </div>
                        </div>
                    </div>
                    <% }); %>
            </div>
        </div>
    </div>


    <footer>
        <div class="footer-up">
            <div class="footer-left">
                <h2>Contact</h2>
                <p>Email: physicure.work@gmail.com</p>
                <p>ƒê·ªãa ch·ªâ: 43 Nguy·ªÖn Ch√≠ Thanh, Gi·∫£ng V√µ, Ba ƒê√¨nh, H√† N·ªôi, Vi·ªát Nam</p>
                <div class="icon">
                    <img src="/images/fb.png" alt="fb">
                    <img src="/images/ins.png" alt="ins">
                    <img src="/images/twit.png" alt="tw">
                    <img src="/images/only.png" alt="only">
                </div>
            </div>
            <div class="footer-mid">
                <h2>Link</h2>
                <p><a href="/">Home</a></p>
                <p><a href="/login">L·ªãch h·∫πn</a></p>
                <p><a href="/html/location.html">C∆° s·ªü</a></p>
                <p><a href="/html/services.html">D·ªãch v·ª•</a></p>
                <p><a href="/html/blog.html">Blog</a></p>
                <p style="width: 85px;"><a href="/html/career.html">Tuy·ªÉn d·ª•ng</a></p>
                <p><a href="/" class="header-logout">Log out</a></p>
            </div>
            <div class="footer-right">
                <h2>Subs</h2>
                <input type="email" placeholder="ƒêƒÉng k√≠ Email ƒë·ªÉ nh·∫≠n th√¥ng tin m·ªõi nh·∫•t">
                <button>ƒêƒÉng k√≠</button>
            </div>
        </div>
        <div class="footer-down">
            <p>Copyright: 2024 PhysiCURE</p>
        </div>
    </footer>
    <script>
        const logOut = async (event) => {
            event.preventDefault();
            await localStorage.clear();
            window.location.href = '/';
        }

        const logout = document.querySelector('.header-logout');
        logout.addEventListener('click', logOut);

        const today = new Date().toISOString().split('T')[0];
        // Set the min attribute of the appointmentDate input to today's date
        document.getElementById('appointmentDate').setAttribute('min', today);


        const modal = document.querySelector(".modal");
        const overlay = document.querySelector(".overlay");
        const openModalBtn = document.querySelector(".btn-open-modal");
        const closeModalBtn = document.querySelector(".btn-close");
        const openModal = function () {
            modal.classList.remove("hidden");
            overlay.classList.remove("hidden");

        };
        openModalBtn.addEventListener("click", openModal);

        const closeModal = function () {
            modal.classList.add("hidden");
            overlay.classList.add("hidden");
            form.reset();
        };
        closeModalBtn.addEventListener("click", closeModal);
        overlay.addEventListener("click", closeModal);

        const submitSchedule = async (event) => {
            event.preventDefault();
            const formData = new FormData(form);
            const data = {};
            formData.forEach((value, key) => {
                data[key] = value;
            });
            data.userId = localStorage.getItem('userId');
            console.log(data);
            const response = await fetch("/api/user-create-new-schedule", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(data)
            });
            const result = await response.json();
            if (response.ok && result.errCode === 0) {
                alert('Create schedule successfully üéâ');
                closeModal();
                console.log('result:', result);
                console.log('response', response);
            }
            else {
                alert('Some error occured, try again later üò•');
                closeModal();
            }
        }
        const form = document.querySelector("#form");
        form.addEventListener('submit', submitSchedule)
    </script>
</body>

</html>